<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Urban Lunch</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --bg: #ffffff; --text: #000000; --hint: #8e8e93; --btn-bg: #f2f2f7; --accent: #ff3b30; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding-bottom: 100px; user-select: none; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; padding: 15px; }
        .card { display: flex; flex-direction: column; background: #fff; border-radius: 18px; overflow: hidden; }
        .img-box { width: 100%; aspect-ratio: 1/1; background: #f9f9f9; }
        .img-box img { width: 100%; height: 100%; object-fit: cover; }
        .card-info { padding: 10px; }
        .price-tag { background: var(--btn-bg); border: none; border-radius: 10px; padding: 8px; width: 100%; font-weight: bold; cursor: pointer; }
        .main-btn { position: fixed; bottom: 20px; left: 20px; right: 20px; background: #000; color: #fff; border: none; padding: 15px; border-radius: 15px; font-weight: bold; z-index: 100; }
        #cart-view { position: fixed; inset: 0; background: #fff; z-index: 200; display: none; padding: 20px; }
    </style>
</head>
<body>

<div id="app" class="grid"></div>
<button class="main-btn" id="cart-btn" style="display:none;" onclick="showCart()">Корзина</button>

<div id="cart-view">
    <h2>Ваш заказ</h2>
    <div id="cart-items"></div>
    <button class="main-btn" onclick="sendOrder()">Оформить и оплатить</button>
    <button onclick="hideCart()" style="margin-top:70px; border:none; background:none; color:blue;">Назад в меню</button>
</div>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    const products = [
        { id: 1, name: "Капучино", price: 190, img: "kapuchino-min.jpg" },
        { id: 2, name: "Латте", price: 230, img: "latte-min.jpg" },
        { id: 3, name: "Раф", price: 250, img: "latte-min.jpg" }
    ];

    let cart = [];

    function render() {
        const app = document.getElementById('app');
        app.innerHTML = products.map(p => `
            <div class="card">
                <div class="img-box"><img src="${p.img}"></div>
                <div class="card-info">
                    <div>${p.name}</div>
                    <button class="price-tag" onclick="addToCart(${p.id})">${p.price} ₽ +</button>
                </div>
            </div>
        `).join('');
    }

    function addToCart(id) {
        const p = products.find(x => x.id === id);
        cart.push(p);
        document.getElementById('cart-btn').style.display = 'block';
        document.getElementById('cart-btn').innerText = `В корзину (${cart.length})`;
    }

    function showCart() {
        document.getElementById('cart-view').style.display = 'block';
        document.getElementById('cart-items').innerHTML = cart.map(i => `<p>${i.name} - ${i.price} ₽</p>`).join('');
    }

    function hideCart() { document.getElementById('cart-view').style.display = 'none'; }

    function sendOrder() {
        if (cart.length === 0) return;
        const data = {
            products: cart.map(i => ({ name: i.name, price: i.price, description: "Классика" }))
        };
        tg.sendData(JSON.stringify(data));
    }

    render();
</script>
</body>
</html>
