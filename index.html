<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Urban Lunch Menu</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --bg: #ffffff; --text: #000000; --hint: #8e8e93; --btn-bg: #f2f2f7; }
        body { font-family: -apple-system, system-ui, sans-serif; background: var(--bg); margin: 0; padding-bottom: 100px; color: var(--text); }
        .header { position: sticky; top: 0; background: #fff; z-index: 100; border-bottom: 1px solid #eee; padding: 10px 0; }
        .cat-nav { display: flex; overflow-x: auto; padding: 0 15px; gap: 20px; scrollbar-width: none; }
        .cat-link { white-space: nowrap; font-size: 15px; color: var(--hint); cursor: pointer; padding-bottom: 5px; }
        .cat-link.active { color: #000; border-bottom: 2px solid #000; font-weight: 600; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; padding: 15px; }
        .card { display: flex; flex-direction: column; cursor: pointer; }
        .img-box { width: 100%; aspect-ratio: 1/1; background: #f5f5f5; border-radius: 18px; overflow: hidden; position: relative; }
        .img-box img { width: 100%; height: 100%; object-fit: cover; }
        .card-info { margin-top: 8px; font-size: 14px; font-weight: 500; }
        .price-tag { background: var(--btn-bg); border-radius: 10px; padding: 6px 10px; margin-top: 4px; display: flex; justify-content: space-between; align-items: center; font-weight: bold; }
        
        /* ÐœÐ¾Ð´Ð°Ð»ÐºÐ¸ */
        #modal-overlay, #cart-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.4); display: none; z-index: 1000; }
        #modal, #cart-view { position: fixed; bottom: -100%; left: 0; width: 100%; background: #fff; border-radius: 24px 24px 0 0; padding: 20px; box-sizing: border-box; z-index: 1001; transition: 0.3s ease; max-height: 80vh; overflow-y: auto; }
        .open { bottom: 0 !important; }
        .main-btn { width: 100%; background: #000; color: #fff; border: none; padding: 16px; border-radius: 14px; font-size: 16px; font-weight: 600; margin-top: 10px; }
        .size-btn { width: 100%; background: var(--btn-bg); border: none; padding: 12px; border-radius: 12px; margin-bottom: 8px; text-align: left; font-size: 15px; display: flex; justify-content: space-between; }
        
        #cart-button-fixed { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); z-index: 999; }
        .cart-btn-ui { background: #000; color: #fff; padding: 12px 24px; border-radius: 30px; border: none; font-weight: bold; box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
    </style>
</head>
<body>

    <div class="header">
        <div class="cat-nav" id="cat-nav"></div>
    </div>

    <div id="app" class="grid"></div>

    <div id="cart-button-fixed">
        <button class="cart-btn-ui" onclick="openCart()">ðŸ›’ ÐšÐ¾Ñ€Ð·Ð¸Ð½Ð° (<span id="cart-count">0</span>)</button>
    </div>

    <div id="modal-overlay" onclick="closeModal()"></div>
    <div id="modal">
        <div id="modal-content"></div>
    </div>

    <div id="cart-overlay" onclick="closeCart()"></div>
    <div id="cart-view">
        <h2 style="margin-top:0">Ð’Ð°Ñˆ Ð·Ð°ÐºÐ°Ð·</h2>
        <div id="cart-list"></div>
        <hr style="border:0; border-top:1px solid #eee; margin:15px 0">
        <div style="display:flex; justify-content:space-between; font-size:18px; font-weight:bold">
            <span>Ð˜Ñ‚Ð¾Ð³Ð¾:</span>
            <span id="cart-total">0 â‚½</span>
        </div>
        <button class="main-btn" onclick="sendOrder()">ÐžÑ„Ð¾Ñ€Ð¼Ð¸Ñ‚ÑŒ Ð·Ð°ÐºÐ°Ð·</button>
    </div>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand(); // Ð Ð°ÑÑˆÐ¸Ñ€Ð¸Ñ‚ÑŒ Ð½Ð° Ð²ÐµÑÑŒ ÑÐºÑ€Ð°Ð½

    const menuData = [
        { category: "ÐšÐ¾Ñ„Ðµ", items: [
            { id: 1, name: "ÐšÐ°Ð¿ÑƒÑ‡Ð¸Ð½Ð¾", image: "kapuchino-min.jpg", prices: {"250Ð¼Ð»": 190, "350Ð¼Ð»": 230, "450Ð¼Ð»": 270} },
            { id: 2, name: "Ð›Ð°Ñ‚Ñ‚Ðµ", image: "latte-min.jpg", prices: {"250Ð¼Ð»": 190, "350Ð¼Ð»": 230, "450Ð¼Ð»": 270} },
            { id: 3, name: "Ð Ð°Ñ„ Ð¡Ð½Ð¸ÐºÐµÑ€Ñ", image: "raf-min.jpg", prices: {"350Ð¼Ð»": 250, "450Ð¼Ð»": 290} }
        ]},
        { category: "Ð§Ð°Ð¹", items: [
            { id: 10, name: "Ð§Ð°Ð¹ Ð§ÐµÑ€Ð½Ñ‹Ð¹/Ð—ÐµÐ»ÐµÐ½Ñ‹Ð¹", image: "tea-min.jpg", prices: {"250Ð¼Ð»": 120, "450Ð¼Ð»": 180} },
            { id: 11, name: "Ð“Ð»Ð¸Ð½Ñ‚Ð²ÐµÐ¹Ð½ (Ð±/Ð°)", image: "glintvein-min.jpg", prices: {"350Ð¼Ð»": 230, "450Ð¼Ð»": 270} }
        ]},
        { category: "ÐŸÑƒÐ½ÑˆÐ¸", items: [
            { id: 20, name: "ÐžÐ±Ð»ÐµÐ¿Ð¸Ñ…Ð¾Ð²Ñ‹Ð¹ Ð¿ÑƒÐ½Ñˆ", image: "oblepiha-min.jpg", prices: {"350Ð¼Ð»": 230, "450Ð¼Ð»": 270} },
            { id: 21, name: "ÐœÐ°Ð»Ð¸Ð½Ð¾Ð²Ñ‹Ð¹ Ð¿ÑƒÐ½Ñˆ", image: "malina-min.jpg", prices: {"350Ð¼Ð»": 230, "450Ð¼Ð»": 270} }
        ]},
        { category: "Ð¡Ð»Ð°Ð´Ð¾ÑÑ‚Ð¸", items: [
            { id: 30, name: "Bombbar ÐšÐ¾ÐºÐ¾Ñ", image: "bombbar-min.jpg", prices: {"1 ÑˆÑ‚": 130} },
            { id: 31, name: "Snaqer ÐžÑ€ÐµÑ…", image: "snaqer-min.jpg", prices: {"1 ÑˆÑ‚": 130} }
        ]},
        { category: "Ð“Ð°Ð·Ð¸Ñ€Ð¾Ð²ÐºÐ°", items: [
            { id: 40, name: "ÐšÐ¾Ð»Ð° Ð§ÐµÑ€Ð½Ð¾Ð³Ð¾Ð»Ð¾Ð²ÐºÐ°", image: "cola-min.jpg", prices: {"0.5Ð»": 140} },
            { id: 41, name: "Ð’Ð¾Ð´Ð° Ð“Ð°Ð·/ÐÐµÐ³Ð°Ð·", image: "water-min.jpg", prices: {"0.5Ð»": 70} }
        ]}
    ];

    let cart = [];

    function init() {
        const nav = document.getElementById('cat-nav');
        nav.innerHTML = menuData.map((c, i) => `
            <div class="cat-link ${i===0?'active':''}" onclick="filterCat('${c.category}', this)">${c.category}</div>
        `).join('');
        renderProducts(menuData[0].items);
    }

    function filterCat(name, el) {
        document.querySelectorAll('.cat-link').forEach(l => l.classList.remove('active'));
        el.classList.add('active');
        renderProducts(menuData.find(c => c.category === name).items);
    }

    function renderProducts(items) {
        const app = document.getElementById('app');
        app.innerHTML = items.map(item => `
            <div class="card" onclick="openItem(${item.id})">
                <div class="img-box"><img src="${item.image}" alt="${item.name}"></div>
                <div class="card-info">${item.name}</div>
                <div class="price-tag">Ð¾Ñ‚ ${Math.min(...Object.values(item.prices))} â‚½ <span>+</span></div>
            </div>
        `).join('');
    }

    function openItem(id) {
        let item;
        menuData.forEach(c => c.items.forEach(i => { if(i.id === id) item = i; }));
        
        let content = `<h3>${item.name}</h3><p style="color:gray">Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ñ€Ð°Ð·Ð¼ÐµÑ€:</p>`;
        for (let size in item.prices) {
            content += `
                <button class="size-btn" onclick="addToCart('${item.name}', '${size}', ${item.prices[size]})">
                    <span>${size}</span> <b>${item.prices[size]} â‚½</b>
                </button>`;
        }
        
        document.getElementById('modal-content').innerHTML = content;
        document.getElementById('modal-overlay').style.display = 'block';
        document.getElementById('modal').classList.add('open');
    }

    function addToCart(name, size, price) {
        cart.push({ name, size, price });
        document.getElementById('cart-count').innerText = cart.length;
        closeModal();
        tg.HapticFeedback.impactOccurred('light');
    }

    function openCart() {
        if (cart.length === 0) return;
        const list = document.getElementById('cart-list');
        list.innerHTML = cart.map((i, idx) => `
            <div style="display:flex; justify-content:space-between; margin-bottom:10px">
                <span>${i.name} (${i.size})</span>
                <b>${i.price} â‚½</b>
            </div>
        `).join('');
        
        const total = cart.reduce((sum, item) => sum + item.price, 0);
        document.getElementById('cart-total').innerText = total + ' â‚½';
        
        document.getElementById('cart-overlay').style.display = 'block';
        document.getElementById('cart-view').classList.add('open');
    }

    // Ð¢Ð Ð¡ÐÐœÐÐ¯ Ð¤Ð£ÐÐšÐ¦Ð˜Ð¯ Ð”Ð›Ð¯ Ð‘ÐžÐ¢Ð
    window.sendOrder = () => {
        if (cart.length === 0) return;

        const orderData = {
            title: "Ð—Ð°ÐºÐ°Ð· Urban Lunch",
            prices: cart.map(item => ({
                label: `${item.name} (${item.size})`,
                amount: item.price * 100 // Ð’ ÐºÐ¾Ð¿ÐµÐ¹ÐºÐ°Ñ… Ð´Ð»Ñ Telegram
            }))
        };

        // ÐžÐ¢ÐŸÐ ÐÐ’ÐšÐ Ð”ÐÐÐÐ«Ð¥ Ð’ Ð‘ÐžÐ¢
        tg.sendData(JSON.stringify(orderData));
    };

    function closeModal() { 
        document.getElementById('modal').classList.remove('open'); 
        setTimeout(() => document.getElementById('modal-overlay').style.display='none', 300); 
    }
    
    function closeCart() { 
        document.getElementById('cart-view').classList.remove('open'); 
        setTimeout(() => document.getElementById('cart-overlay').style.display='none', 300); 
    }

    init();
</script>
</body>
</html>
