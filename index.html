<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Urban Lunch</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg: #ffffff;
            --text: #000000;
            --hint: #999999;
            --btn-bg: #f2f2f7;
            --accent: #000000;
            --tg-btn: var(--tg-theme-button-color, #000000);
        }
        body { font-family: -apple-system, system-ui, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding-bottom: 90px; }
        
        /* –®–∞–ø–∫–∞ –∏ –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ */
        .header-sticky { position: sticky; top: 0; background: var(--bg); z-index: 100; padding-top: 10px; border-bottom: 1px solid #eee; }
        .top-row { display: flex; align-items: center; padding: 0 15px 10px; gap: 10px; }
        .search-trigger { background: var(--btn-bg); border: none; padding: 10px; border-radius: 10px; cursor: pointer; display: flex; align-items: center; }
        
        .categories-scroll { display: flex; overflow-x: auto; padding: 5px 15px 15px; gap: 20px; scrollbar-width: none; }
        .categories-scroll::-webkit-scrollbar { display: none; }
        .cat-item { white-space: nowrap; font-size: 14px; color: var(--hint); font-weight: 500; cursor: pointer; }
        .cat-item.active { color: var(--text); border-bottom: 2px solid var(--text); padding-bottom: 2px; }

        /* –°–µ—Ç–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ */
        .product-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; padding: 15px; }
        .card { background: var(--bg); border-radius: 15px; overflow: hidden; display: flex; flex-direction: column; }
        .img-wrap { width: 100%; aspect-ratio: 1/1; background: #f9f9f9; border-radius: 15px; overflow: hidden; position: relative; }
        .img-wrap img { width: 100%; height: 100%; object-fit: cover; }
        
        .info { padding: 8px 2px; flex-grow: 1; }
        .name { font-size: 14px; font-weight: 500; margin-bottom: 8px; line-height: 1.2; height: 34px; overflow: hidden; }
        
        .price-btn { background: var(--btn-bg); border: none; border-radius: 12px; padding: 10px; width: 100%; text-align: left; font-weight: 600; font-size: 14px; display: flex; justify-content: space-between; align-items: center; cursor: pointer; }
        .price-btn:active { opacity: 0.7; }

        /* –ü–æ–∏—Å–∫ */
        #search-input-wrap { padding: 0 15px 10px; display: none; }
        .search-field { width: 100%; padding: 12px; border-radius: 10px; border: none; background: var(--btn-bg); outline: none; }

        /* –ù–∞–≤–∏–≥–∞—Ü–∏—è —Å–Ω–∏–∑—É */
        .tab-bar { position: fixed; bottom: 0; width: 100%; background: rgba(255,255,255,0.9); backdrop-filter: blur(10px); display: flex; border-top: 1px solid #eee; padding: 10px 0 25px; z-index: 1000; }
        .tab { flex: 1; text-align: center; font-size: 10px; color: var(--hint); }
        .tab.active { color: var(--text); }
        .tab-icon { font-size: 22px; display: block; margin-bottom: 4px; }

        /* –ú–æ–¥–∞–ª–∫–∏ (–ª–æ–≥–∏–∫–∞ —Ç–∞ –∂–µ) */
        #modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.4); display: none; z-index: 2000; }
        #modal { position: fixed; bottom: -100%; left: 0; width: 100%; background: #fff; border-radius: 20px 20px 0 0; padding: 20px; box-sizing: border-box; z-index: 2001; transition: 0.3s; max-height: 90vh; overflow-y: auto; }
        #modal.open { bottom: 0; }
        
        .section-label { font-size: 11px; font-weight: 700; text-transform: uppercase; color: #888; margin: 15px 0 8px; }
        .opt-list { display: flex; flex-wrap: wrap; gap: 8px; }
        .opt-btn { background: var(--btn-bg); padding: 10px 14px; border-radius: 10px; font-size: 13px; cursor: pointer; border: 2px solid transparent; }
        .opt-btn.active { border-color: #000; background: #fff; font-weight: 600; }
        .add-btn { width: 100%; background: #000; color: #fff; border: none; padding: 18px; border-radius: 15px; font-weight: 700; margin-top: 20px; font-size: 16px; }
    </style>
</head>
<body>

<div class="header-sticky">
    <div class="top-row">
        <button class="search-trigger" onclick="toggleSearch()">üîç</button>
        <div style="font-weight: 700; font-size: 17px;">Urban Lunch</div>
    </div>
    <div id="search-input-wrap">
        <input type="text" class="search-field" placeholder="–ü–æ–∏—Å–∫ –Ω–∞–ø–∏—Ç–∫–æ–≤..." oninput="search(this.value)">
    </div>
    <div class="categories-scroll" id="cat-list"></div>
</div>

<div id="app" class="product-grid"></div>

<div class="tab-bar">
    <div class="tab active"><span class="tab-icon">üè†</span>–ì–ª–∞–≤–Ω–∞—è</div>
    <div class="tab" onclick="switchTab('fav')"><span class="tab-icon">‚ù§Ô∏è</span>–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</div>
    <div class="tab" onclick="tg.MainButton.show(); openCart();"><span class="tab-icon">üõí</span>–ó–∞–∫–∞–∑</div>
</div>

<div id="modal-overlay" onclick="closeModal()"></div>
<div id="modal"><div id="modal-content"></div></div>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    const menuData = [
        { category: "–ö–æ—Ñ–µ", items: [
            { id: 1, name: "–ö–∞–ø—É—á–∏–Ω–æ", image: "https://placehold.co/400x400?text=Cappuccino", prices: {"250–º–ª": 190, "350–º–ª": 230, "450–º–ª": 270}, hasMilk: true, hasSyrup: true, hasSugar: true, hasCinnamon: true },
            { id: 2, name: "–õ–∞—Ç—Ç–µ", image: "https://placehold.co/400x400?text=Latte", prices: {"250–º–ª": 190, "350–º–ª": 230, "450–º–ª": 270}, hasMilk: true, hasSyrup: true, hasSugar: true, hasCinnamon: true },
            { id: 3, name: "–ê–º–µ—Ä–∏–∫–∞–Ω–æ", image: "https://placehold.co/400x400?text=Americano", prices: {"250–º–ª": 180, "350–º–ª": 220, "450–º–ª": 260}, hasSyrup: true, hasSugar: true, hasCinnamon: true },
            { id: 4, name: "–ë–∞–º–±–ª –¢–µ–ø–ª—ã–π", image: "https://placehold.co/400x400?text=Bumble", prices: {"250–º–ª": 270, "350–º–ª": 270, "450–º–ª": 300}, hasJuice: true, hasSyrup: true, hasSugar: true }
        ]},
        { category: "–ß–∞–π", items: [
            { id: 5, name: "–ß–∞–π –ß–µ—Ä–Ω—ã–π", image: "https://placehold.co/400x400?text=Black+Tea", prices: {"250–º–ª": 120, "350–º–ª": 150, "450–º–ª": 180}, hasSugar: true, hasLemon: true },
            { id: 6, name: "–ü—Ä—è–Ω—ã–π –ß–∞–π", image: "https://placehold.co/400x400?text=Spicy+Tea", prices: {"250–º–ª": 240, "350–º–ª": 280, "450–º–ª": 320}, hasMilk: true, hasSyrup: true, hasSugar: true }
        ]},
        { category: "–•–æ–ª–æ–¥–Ω—ã–µ", items: [
            { id: 7, name: "–õ–∏–º–æ–Ω–∞–¥", image: "https://placehold.co/400x400?text=Lemonade", prices: {"350–º–ª": 260, "450–º–ª": 290}, hasLemonadeTaste: true }
        ]}
    ];

    let cart = [];
    let cur = {};

    function init() {
        const catList = document.getElementById('cat-list');
        catList.innerHTML = menuData.map((c, idx) => `<div class="cat-item ${idx===0?'active':''}" onclick="scrollToCat('${c.category}', this)">${c.category}</div>`).join('');
        
        renderProducts(menuData);
    }

    function renderProducts(data) {
        const app = document.getElementById('app');
        app.innerHTML = '';
        data.forEach(cat => {
            cat.items.forEach(item => {
                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `
                    <div class="img-wrap" onclick="openItem(${item.id})"><img src="${item.image}"></div>
                    <div class="info">
                        <div class="name">${item.name}</div>
                        <button class="price-btn" onclick="openItem(${item.id})">
                            ${Object.values(item.prices)[0]} ‚ÇΩ <span>+</span>
                        </button>
                    </div>
                `;
                app.appendChild(card);
            });
        });
    }

    function openItem(id) {
        let item;
        menuData.forEach(c => c.items.forEach(i => { if(i.id === id) item = i; }));
        cur = { item, size: Object.keys(item.prices)[0], milk: "–û–±—ã—á–Ω–æ–µ", syrup: "–ù–µ—Ç", sugar: "0–≥", cinnamon: "–ù–µ—Ç", lemonadeTaste: "–ö–∏–≤–∏-–§–µ–π—Ö–æ–∞" };
        showModal();
    }

    function showModal() {
        const i = cur.item;
        const cont = document.getElementById('modal-content');
        cont.innerHTML = `
            <div style="text-align:center"><img src="${i.image}" style="width:120px; border-radius:15px"></div>
            <h2 style="text-align:center; margin:10px 0 0">${i.name}</h2>
            
            <div class="section-label">–û–±—ä–µ–º</div>
            <div class="opt-list">${Object.keys(i.prices).map(s => `<div class="opt-btn ${s==cur.size?'active':''}" onclick="cur.size='${s}';showModal()">${s}</div>`).join('')}</div>
            
            ${i.hasMilk ? `<div class="section-label">–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–µ –º–æ–ª–æ–∫–æ (+70‚ÇΩ)</div><div class="opt-list">${['–û–±—ã—á–Ω–æ–µ','–ë–∞–Ω–∞–Ω–æ–≤–æ–µ','–ö–æ–∫–æ—Å–æ–≤–æ–µ'].map(m=>`<div class="opt-btn ${m==cur.milk?'active':''}" onclick="cur.milk='${m}';showModal()">${m}</div>`).join('')}</div>`:''}
            
            ${i.hasSugar ? `<div class="section-label">–°–∞—Ö–∞—Ä</div><div class="opt-list">${['0–≥','5–≥','10–≥','20–≥'].map(g=>`<div class="opt-btn ${cur.sugar==g?'active':''}" onclick="cur.sugar='${g}';showModal()">${g}</div>`).join('')}</div>`:''}
            
            <button class="add-btn" onclick="addToCart()">–î–æ–±–∞–≤–∏—Ç—å ‚Äî ${calcP()} ‚ÇΩ</button>
        `;
        document.getElementById('modal-overlay').style.display = 'block';
        document.getElementById('modal').classList.add('open');
    }

    function calcP() {
        let p = cur.item.prices[cur.size];
        if(cur.milk !== '–û–±—ã—á–Ω–æ–µ') p += 70;
        return p;
    }

    function addToCart() {
        cart.push({...cur, finalPrice: calcP()});
        tg.MainButton.setText(`–í –∫–æ—Ä–∑–∏–Ω–µ ${cart.length} —Ç–æ–≤. –Ω–∞ ${cart.reduce((a,b)=>a+b.finalPrice,0)} ‚ÇΩ`).show();
        closeModal();
    }

    function closeModal() {
        document.getElementById('modal').classList.remove('open');
        setTimeout(() => document.getElementById('modal-overlay').style.display='none', 300);
    }

    function toggleSearch() {
        const s = document.getElementById('search-input-wrap');
        s.style.display = (s.style.display === 'block') ? 'none' : 'block';
    }

    function search(q) {
        const res = menuData.map(c => ({ category: c.category, items: c.items.filter(i => i.name.toLowerCase().includes(q.toLowerCase())) })).filter(c => c.items.length > 0);
        renderProducts(res);
    }

    init();
</script>
</body>
</html>
