<script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    // 1. ПРИ ОТКРЫТИИ: Загружаем стоп-лист из памяти телефона
    let stopList = JSON.parse(localStorage.getItem('urbanStopList') || "[]");

    let isAdmin = false;
    const menu = [
        { id: 1, name: "Капучино", price: 190 },
        { id: 2, name: "Латте", price: 190 },
        { id: 3, name: "Американо", price: 150 },
        { id: 4, name: "Чай Черный", price: 120 }
    ];
    let cart = [];

    // Логика админа (пароль 7654)
    let pressTimer;
    document.getElementById('main-header').addEventListener('touchstart', () => {
        pressTimer = window.setTimeout(() => {
            if (prompt("Пароль:") === "7654") {
                isAdmin = true;
                document.getElementById('admin-panel').style.display = 'block';
                render();
            }
        }, 1500);
    });
    document.getElementById('main-header').addEventListener('touchend', () => clearTimeout(pressTimer));

    function render() {
        const app = document.getElementById('app');
        const visibleMenu = isAdmin ? menu : menu.filter(item => !stopList.includes(item.id));
        
        app.innerHTML = visibleMenu.map(item => {
            const isHidden = stopList.includes(item.id);
            return `
                <div class="card ${isAdmin && isHidden ? 'selected-to-hide' : ''}" 
                     onclick="${isAdmin ? `toggleAdminSelection(${item.id})` : `addToCart(${item.id})`}">
                    <div class="img-placeholder"></div>
                    <div style="font-weight:600">${item.name}</div>
                    <div>${item.price} ₽</div>
                    ${isAdmin ? `<div style="color:red; font-size:10px">${isHidden ? 'СКРЫТО' : 'ВИДИМО'}</div>` : ''}
                </div>
            `;
        }).join('');
    }

    function toggleAdminSelection(id) {
        if (stopList.includes(id)) {
            stopList = stopList.filter(item => item !== id);
        } else {
            stopList.push(id);
        }
        render();
    }

    function saveAdminChanges() {
        // 2. СОХРАНЯЕМ: В память телефона и отправляем боту
        localStorage.setItem('urbanStopList', JSON.stringify(stopList));
        tg.sendData(JSON.stringify({ type: 'admin_update', stop_list: stopList }));
        isAdmin = false;
        document.getElementById('admin-panel').style.display = 'none';
        tg.close();
    }

    // (Остальные функции addToCart и sendOrder остаются такими же)
    // ... (вставь их из предыдущего кода) ...

    render();
</script>
