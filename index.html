<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Urban Lunch</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --bg: #ffffff; --text: #000000; --hint: #8e8e93; --btn-bg: #f2f2f7; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); margin: 0; padding-bottom: 110px; color: var(--text); }
        .header { position: sticky; top: 0; background: #fff; z-index: 100; border-bottom: 1px solid #eee; }
        .cat-nav { display: flex; overflow-x: auto; padding: 10px 15px; gap: 15px; scrollbar-width: none; }
        .cat-link { white-space: nowrap; font-size: 14px; color: var(--hint); cursor: pointer; border-bottom: 2px solid transparent; }
        .cat-link.active { color: #000; border-bottom: 2px solid #000; font-weight: bold; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; padding: 15px; }
        .card { background: #fff; display: flex; flex-direction: column; cursor: pointer; }
        .img-placeholder { width: 100%; aspect-ratio: 1/1; background: #f5f5f5; border-radius: 15px; display: flex; align-items: center; justify-content: center; font-size: 30px; }
        .card-name { font-size: 14px; margin: 8px 0 4px; font-weight: 500; }
        .price-btn { background: var(--btn-bg); border: none; border-radius: 10px; padding: 8px; width: 100%; font-weight: bold; }
        
        #modal-overlay, #cart-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); display: none; z-index: 1000; }
        #modal, #cart-view { position: fixed; bottom: -100%; left: 0; width: 100%; background: #fff; border-radius: 20px 20px 0 0; padding: 20px; box-sizing: border-box; z-index: 1001; transition: 0.3s; max-height: 90vh; overflow-y: auto; }
        .open { bottom: 0 !important; }
        .main-btn { width: 100%; background: #000; color: #fff; border: none; padding: 15px; border-radius: 12px; font-weight: bold; margin-top: 10px; }
        
        .option-group { margin: 15px 0; }
        .option-title { font-weight: bold; margin-bottom: 8px; font-size: 14px; }
        .opt-btn { padding: 8px 12px; background: #f2f2f7; border-radius: 8px; border: 1px solid transparent; margin: 0 5px 5px 0; display: inline-block; font-size: 13px; }
        .opt-btn.selected { border-color: #000; background: #e8e8ed; }
    </style>
</head>
<body>
    <div class="header"><div class="cat-nav" id="cat-nav"></div></div>
    <div id="app" class="grid"></div>

    <div style="position: fixed; bottom: 20px; width: 100%; text-align: center; z-index: 500;">
        <button onclick="openCart()" id="cart-main-btn" style="background:#000; color:#fff; padding: 15px 40px; border-radius: 30px; border:none; font-weight:bold; box-shadow: 0 4px 15px rgba(0,0,0,0.3); display:none;">
            –ö–æ—Ä–∑–∏–Ω–∞ (<span id="count">0</span>)
        </button>
    </div>

    <div id="modal-overlay" onclick="closeModal()"></div>
    <div id="modal"><div id="modal-content"></div></div>
    <div id="cart-overlay" onclick="closeCart()"></div>
    <div id="cart-view">
        <h2 style="margin-top:0">–í–∞—à –∑–∞–∫–∞–∑</h2>
        <div id="cart-list"></div>
        <div id="cart-total" style="font-weight:bold; font-size: 18px; margin-top:15px; border-top: 1px solid #eee; padding-top: 15px;"></div>
        <button class="main-btn" onclick="sendOrder()">–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</button>
    </div>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    const menuData = [
        { category: "–ö–æ—Ñ–µ", items: [
            { id: 1, name: "–ö–∞–ø—É—á–∏–Ω–æ", prices: {"250–º–ª": 190, "350–º–ª": 230, "450–º–ª": 270}, emoji: "‚òï", hasAddons: true },
            { id: 2, name: "–õ–∞—Ç—Ç–µ", prices: {"250–º–ª": 190, "350–º–ª": 230, "450–º–ª": 270}, emoji: "ü•õ", hasAddons: true },
            { id: 3, name: "–≠—Å–ø—Ä–µ—Å—Å–æ", prices: {"30/60–º–ª": 110}, emoji: "‚òï" },
            { id: 4, name: "–ê–º–µ—Ä–∏–∫–∞–Ω–æ", prices: {"250–º–ª": 180, "350–º–ª": 220, "450–º–ª": 260}, emoji: "‚òï", hasAddons: true },
            { id: 5, name: "–§–ª–∞—Ç –£–∞–π—Ç", prices: {"250–º–ª": 220, "350–º–ª": 260, "450–º–ª": 360}, emoji: "ü•õ", hasAddons: true },
            { id: 6, name: "–†–∞—Ñ", prices: {"250–º–ª": 210, "350–º–ª": 250, "450–º–ª": 290}, emoji: "‚òÅÔ∏è", hasAddons: true }
        ]},
        { category: "–ß–∞–π", items: [
            { id: 10, name: "–ß–∞–π –ß–µ—Ä–Ω—ã–π", prices: {"250–º–ª": 120, "450–º–ª": 180}, emoji: "üçµ" },
            { id: 11, name: "–ß–∞–π –ó–µ–ª–µ–Ω—ã–π", prices: {"250–º–ª": 120, "450–º–ª": 180}, emoji: "üçµ" },
            { id: 17, name: "–ì–ª–∏–Ω—Ç–≤–µ–π–Ω", prices: {"350–º–ª": 230, "450–º–ª": 270}, emoji: "üç∑" }
        ]},
        { category: "–ü—É–Ω—à–∏", items: [
            { id: 50, name: "–û–±–ª–µ–ø–∏—Ö–æ–≤—ã–π –ø—É–Ω—à", prices: {"350–º–ª": 230, "450–º–ª": 270}, emoji: "üü†" },
            { id: 51, name: "–ú–∞–ª–∏–Ω–æ–≤—ã–π –ø—É–Ω—à", prices: {"350–º–ª": 230, "450–º–ª": 270}, emoji: "üî¥" }
        ]},
        { category: "–°–ª–∞–¥–æ—Å—Ç–∏", items: [
            { id: 60, name: "Bombbar –∫–æ–∫–æ—Å", prices: {"1—à—Ç": 130}, emoji: "ü••" },
            { id: 63, name: "Snaqer –æ—Ä–µ—Ö", prices: {"1—à—Ç": 130}, emoji: "üç´" }
        ]},
        { category: "–ì–∞–∑–∏—Ä–æ–≤–∫–∞", items: [
            { id: 80, name: "Cola", prices: {"0.5–ª": 140}, emoji: "ü•§" },
            { id: 82, name: "–ì–∞–∑/–ù–µ–≥–∞–∑", prices: {"0.5–ª": 70}, emoji: "üíß" }
        ]}
    ];

    let cart = [];
    let currentSelection = {};

    function init() {
        const nav = document.getElementById('cat-nav');
        nav.innerHTML = menuData.map((c, i) => `<div class="cat-link ${i===0?'active':''}" onclick="filterCat('${c.category}', this)">${c.category}</div>`).join('');
        renderProducts(menuData[0].items);
    }

    function renderProducts(items) {
        const app = document.getElementById('app');
        app.innerHTML = items.map(i => `
            <div class="card" onclick="openItem(${i.id})">
                <div class="img-placeholder">${i.emoji}</div>
                <div class="card-name">${i.name}</div>
                <button class="price-btn">–æ—Ç ${Object.values(i.prices)[0]} ‚ÇΩ</button>
            </div>
        `).join('');
    }

    function filterCat(name, el) {
        document.querySelectorAll('.cat-link').forEach(l => l.classList.remove('active'));
        el.classList.add('active');
        renderProducts(menuData.find(c => c.category === name).items);
    }

    function openItem(id) {
        let item; menuData.forEach(c => c.items.forEach(i => { if(i.id === id) item = i; }));
        currentSelection = { item, size: Object.keys(item.prices)[0], addons: [], milk: "–û–±—ã—á–Ω–æ–µ", price: Object.values(item.prices)[0] };
        
        renderModal();
        document.getElementById('modal-overlay').style.display = 'block';
        document.getElementById('modal').classList.add('open');
    }

    function renderModal() {
        const item = currentSelection.item;
        let html = `<h3>${item.name}</h3>`;
        
        html += `<div class="option-group"><div class="option-title">–†–∞–∑–º–µ—Ä</div>`;
        for(let s in item.prices) {
            html += `<div class="opt-btn ${currentSelection.size === s ? 'selected' : ''}" onclick="updateSize('${s}', ${item.prices[s]})">${s}</div>`;
        }
        html += `</div>`;

        if(item.hasAddons) {
            html += `<div class="option-group"><div class="option-title">–ú–æ–ª–æ–∫–æ</div>`;
            ["–û–±—ã—á–Ω–æ–µ", "–ë–µ–∑–ª–∞–∫—Ç–æ–∑–Ω–æ–µ (+50—Ä)", "–ö–æ–∫–æ—Å–æ–≤–æ–µ (+60—Ä)"].forEach(m => {
                html += `<div class="opt-btn ${currentSelection.milk === m ? 'selected' : ''}" onclick="currentSelection.milk='${m}'; renderModal();">${m}</div>`;
            });
            html += `</div>`;
        }

        html += `<button class="main-btn" onclick="confirmAdd()">–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É</button>`;
        document.getElementById('modal-content').innerHTML = html;
    }

    function updateSize(s, p) { currentSelection.size = s; currentSelection.basePrice = p; renderModal(); }

    function confirmAdd() {
        let finalPrice = currentSelection.item.prices[currentSelection.size];
        if(currentSelection.milk.includes("+50")) finalPrice += 50;
        if(currentSelection.milk.includes("+60")) finalPrice += 60;
        
        cart.push({
            name: `${currentSelection.item.name} (${currentSelection.size}, ${currentSelection.milk})`,
            price: finalPrice
        });
        
        document.getElementById('count').innerText = cart.length;
        document.getElementById('cart-main-btn').style.display = 'inline-block';
        closeModal();
        tg.HapticFeedback.impactOccurred('medium');
    }

    window.sendOrder = () => {
        if(cart.length === 0) return;
        const data = {
            title: "–ó–∞–∫–∞–∑ Urban Lunch",
            prices: cart.map(i => ({ label: i.name, amount: i.price * 100 }))
        };
        tg.sendData(JSON.stringify(data));
        tg.close();
    };

    function openCart() {
        const list = document.getElementById('cart-list');
        list.innerHTML = cart.map(i => `<div style="display:flex; justify-content:space-between; margin-bottom:8px; font-size:13px;"><span>${i.name}</span><b>${i.price} ‚ÇΩ</b></div>`).join('');
        const total = cart.reduce((a, b) => a + b.price, 0);
        document.getElementById('cart-total').innerText = `–ò—Ç–æ–≥–æ: ${total} ‚ÇΩ`;
        document.getElementById('cart-overlay').style.display = 'block';
        document.getElementById('cart-view').classList.add('open');
    }

    function closeModal() { document.getElementById('modal').classList.remove('open'); setTimeout(()=>document.getElementById('modal-overlay').style.display='none', 300); }
    function closeCart() { document.getElementById('cart-view').classList.remove('open'); setTimeout(()=>document.getElementById('cart-overlay').style.display='none', 300); }
    init();
</script>
</body>
</html>
